// @flow
import React from 'react';

export opaque type ResourceCache<Data, Deps> = {};

export opaque type Resource<Data> = {};

export type ResourceQuery<Data> =
  | Data
  | Promise<Data>
  | [Promise<Data>, () => void];

type QueryFunction<Data, Deps> = (...deps: Deps) => ResourceQuery<Data>;

type ResourceOptions<Data, Deps> = {|
  query: QueryFunction<Data, Deps>,
  maxAge?: number,
  capacity?: number,
|};

declare export function createResource<Data, Deps>(
  options: ResourceOptions<Data, Deps>,
): ResourceCache<Data, Deps>;

declare export function useResource<Data, Deps>(
  Resource: ResourceCache<Data, Deps>,
  deps: Deps,
): Resource<Data>;

declare export function useResourceFactory<Data, Deps>(
  query: QueryFunction<Data, Deps>,
  deps: Deps,
): Resource<Data>;

declare export function useResourceFlow<Data, Deps>(
  Resource: ResourceCache<Data, Deps>,
  deps: Deps,
): [Resource<Data>, boolean];

declare export function useResourceSync<Data, Deps>(
  Resource: ResourceCache<Data, Deps>,
  deps: Deps,
): Data;

declare export function useResourceValue<Data>(resource: Resource<Data>): Data;

type ErrorBoundaryProps = {
  fallback: React$Node,
  children: React$Node,
  onError?: (error: any) => void,
};

declare export class ErrorBoundary extends React$Component<ErrorBoundaryProps> {}
